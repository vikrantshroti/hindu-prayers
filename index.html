<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayers Pages Site</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <header>
        <nav>
            <ul id="categoryNav" class="category-nav">
                <li class="category-item selected" data-category="Daily">दैनिक प्रार्थना</li>
                <li class="category-item" data-category="Mantras">मंत्र</li>
                <li class="category-item" data-category="Stotras & Chalisa">तोत्र और चालीसा</li>
                <li class="category-item" data-category="Festivals">त्योहार</li>
                <li class="category-item" data-category="Healing & Gratitude">स्वास्थ्यप्राद और आभार</li>
                <li class="category-item" data-category="Kids">बच्चों के लिए</li>
            </ul>
        </nav>
    </header>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="प्रार्थनाएँ खोजें...">
    </div>

    <!-- Dynamic sections -->
    <div class="container">
        <section id="prayerList">
            <h2>प्रार्थना सूची</h2>
            <ul></ul>
        </section>

        <section id="prayerContent">
            <h2 id="prayerTitle">रार्थना</h2>
            <div class="language-toggle">
                <button class="lang-btn selected" data-lang="sanskrit">संस्कृत</button>
                <button class="lang-btn" data-lang="transliteration">Transliteration / लिप्यंतरण</button>
                <button class="lang-btn" data-lang="english">English</button>
            </div>
            <div class="prayer-text">
                <p id="prayerText">किसी प्रार्थना की विषय-वस्तु देखने के लिए उसे चुनें</p>
            </div>
        </section>
    </div>

    <script type="module">
        // Global variables
        let currentCategory = 'Daily';
        let currentPrayer = null;
        let currentLanguage = 'sanskrit';

        // Initialize a global prayers object with imported data
        let prayers = {};

        async function loadPrayers() {
            const dailyResponse = await fetch('./data/daily.json');
            const mantrasResponse = await fetch('./data/mantras.json');
            const stotrasResponse = await fetch('./data/stotras.json');
            const festivalsResponse = await fetch('./data/festivals.json');
            const healingResponse = await fetch('./data/healing.json');
            const kidsResponse = await fetch('./data/kids.json');

            const dailyPrayers = await dailyResponse.json();
            const mantrasPrayers = await mantrasResponse.json();
            const stotrasPrayers = await stotrasResponse.json();
            const festivalsPrayers = await festivalsResponse.json();
            const healingPrayers = await healingResponse.json();
            const kidsPrayers = await kidsResponse.json();

            prayers = {
                "दैनिक प्रार्थना": dailyPrayers,
                "मंत्र": mantrasPrayers,
                "स्तोत्र और चालीसा": stotrasPrayers,
                "त्योहार": festivalsPrayers,
                "स्वास्थ्यप्राद और आभार": healingPrayers,
                "बच्चों के लिए": kidsPrayers,
            };

            loadPrayerList(currentCategory);
        }

        // Set up event listeners for navigation items
        function setupNavigation() {
            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach(item => {
                item.addEventListener('click', function () {
                    // Remove 'selected' class from all items
                    categoryItems.forEach(el => el.classList.remove('selected'));
                    // Add 'selected' class to clicked item
                    this.classList.add('selected');
                    // Load prayer list for the selected category
                    const category = this.getAttribute('data-category');
                    currentCategory = category;
                    loadPrayerList(category);
                });
            });

            // Set up language toggle
            const langButtons = document.querySelectorAll('.lang-btn');
            langButtons.forEach(btn => {
                btn.addEventListener('click', function () {
                    langButtons.forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                    currentLanguage = this.getAttribute('data-lang');
                    if (currentPrayer) {
                        updatePrayerContent(currentPrayer);
                    }
                });
            });

            // Set up search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                if (searchTerm.length > 2) {
                    searchPrayers(searchTerm);
                } else if (searchTerm.length === 0) {
                    loadPrayerList(currentCategory);
                }
            });

        }

        function loadPrayerList(category) {
            const prayerList = document.querySelector("#prayerList ul");

            prayerList.innerHTML = '';

            if (prayers[category]) {
                Object.keys(prayers[category]).forEach(prayerName => {
                    const li = document.createElement("li");
                    li.textContent = prayerName;
                    li.onclick = () => {
                        // Remove 'selected' class from other prayer items
                        document.querySelectorAll('#prayerList li').forEach(item => item.classList.remove('selected'));
                        // Add 'selected' class to the clicked prayer item
                        li.classList.add('selected');
                        // Load prayer content
                        const prayer = prayers[category][prayerName];
                        prayer.name = prayerName;
                        currentPrayer = prayer;
                        updatePrayerContent(prayer);
                    };

                    prayerList.appendChild(li);
                    // console.log('Appended prayer list item:', prayerName);
                });
            }

            // Reset prayer content
            document.getElementById('prayerTitle').textContent = 'प्रार्थना पाठ';
            document.getElementById('prayerText').textContent = 'किसी प्रार्थना की विषय-वस्तु देखने के लिए उसे चुनें।';
        }

        function updatePrayerContent(prayer) {
            document.getElementById('prayerTitle').textContent = prayer.name;

            // Update text based on selected language
            const prayerText = document.getElementById('prayerText');
            prayerText.textContent = prayer[currentLanguage];

        }

        function searchPrayers(searchTerm) {
            const prayerList = document.querySelector("#prayerList ul");
            prayerList.innerHTML = "";

            // Search across all categories
            Object.keys(prayers).forEach(category => {
                Object.keys(prayers[category]).forEach(prayerName => {
                    const prayer = prayers[category][prayerName];

                    // Check if search term is in prayer name or content
                    if (prayerName.toLowerCase().includes(searchTerm) ||
                        prayer.sanskrit.toLowerCase().includes(searchTerm) ||
                        prayer.transliteration.toLowerCase().includes(searchTerm) ||
                        prayer.english.toLowerCase().includes(searchTerm)) {

                        const li = document.createElement("li");
                        li.textContent = prayerName + ' (' + category + ')';
                        li.onclick = () => {
                            // Remove 'selected' class from other prayer items
                            document.querySelectorAll('#prayerList li').forEach(item => item.classList.remove('selected'));
                            // Add 'selected' class to the clicked prayer item
                            li.classList.add('selected');
                            // Load prayer content
                            prayer.name = prayerName;
                            currentPrayer = prayer;
                            updatePrayerContent(prayer);
                        };
                        prayerList.appendChild(li);
                    }
                });
            });
        }

        // Initialize UI
        window.onload = function () {
            setupNavigation();
            loadPrayers(); // Initial load
        }
    </script>
    <footer>
        <p>© 2025 TechVik</p>
    </footer>
</body>

</html>